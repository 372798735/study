<!--pages/download/list/list.wxml-->
<view class="container">
  <!-- èµ„æºåˆ—è¡¨ -->
  <view class="resources-wrapper" wx:if="{{resources.length > 0}}">
    <view 
      class="resource-card" 
      wx:for="{{resources}}" 
      wx:key="id"
      bindtap="downloadFile"
      data-url="{{item.fileUrl}}"
      data-type="{{item.fileType}}"
      data-title="{{item.title}}"
      data-filename="{{item.fileName}}"
    >
      <view class="resource-header">
        <view class="resource-icon {{item.fileType === 'pdf' ? 'pdf' : 'word'}}">
          <text>{{item.fileType === 'pdf' ? 'ğŸ“„' : 'ğŸ“'}}</text>
        </view>
        <view class="resource-info">
          <text class="resource-title">{{item.title}}</text>
          <text class="resource-type">{{item.fileType === 'pdf' ? 'PDF' : 'Word'}} æ–‡æ¡£</text>
        </view>
        <view class="download-icon">â¬‡ï¸</view>
      </view>
      
      <view class="resource-description" wx:if="{{item.description}}">
        <text>{{item.description}}</text>
      </view>
      
      <view class="resource-footer">
        <text class="resource-size">å¤§å°ï¼š{{formatFileSize(item.fileSize)}}</text>
        <text class="resource-time">{{item.createdAt}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading && page === 1}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && resources.length === 0}}">
    <view class="empty-icon">ğŸ“¦</view>
    <view class="empty-text">æš‚æ— èµ„æº</view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{resources.length > 0}}">
    <text wx:if="{{loading}}">åŠ è½½ä¸­...</text>
    <text wx:elif="{{!hasMore}}">æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>

<wxs module="utils">
  var formatFileSize = function(bytes) {
    if (!bytes) return "-";
    var k = 1024;
    var sizes = ["B", "KB", "MB", "GB"];
    var i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i];
  };
  
  module.exports = {
    formatFileSize: formatFileSize
  };
</wxs>

